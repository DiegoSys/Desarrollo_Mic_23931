<div [ngClass]="cardClasses" 
     (click)="handleClick($event)"
     tabindex="0"
     (keydown.enter)="handleKeydown($event)"
     [title]="title"
     [draggable]="isDraggable"
     (dragstart)="onDragStart.emit($event)"
     (dragend)="onDragEnd.emit($event)"
     (drop)="onDrop.emit($event)">
  
  <!-- Overlay y acciones al hacer hover -->
  <div class="card-hover-overlay"></div>
  <div class="card-hover-actions">
    <button *ngIf="showEdit" class="btn-icon btn-edit" (click)="handleEdit($event)" title="Editar">
      <span class="icon-action-bg"><i class="pi pi-pencil"></i></span>
    </button>
    <button *ngIf="showDelete && !isInDualView" class="btn-icon btn-danger" (click)="handleDelete($event)" title="Eliminar">
      <span class="icon-action-bg"><i class="pi pi-trash"></i></span>
    </button>
    <button *ngIf="showView" class="btn-icon" (click)="handleView($event)" title="Ver Secciones">
      <span class="icon-action-bg"><i class="pi pi-window-maximize"></i></span>
    </button>
    <button *ngIf="showGoToFields" class="btn-icon" (click)="handleGoToFields($event)" title="Ver campos">
      <span class="icon-action-bg"><i class="pi pi-th-large"></i></span>
    </button>
    <button *ngIf="showRemoveFromTypology && isAssociated" class="btn-icon btn-danger" (click)="handleRemoveFromTypology($event)" title="Quitar de tipología">
      <span class="icon-action-bg"><i class="pi pi-times"></i></span>
    </button>
  </div>

  <div class="card-top-section">
    <span class="card-code">{{code}}</span>
    <span class="card-status" [ngClass]="status" *ngIf="status">
      <i class="pi pi-id-card"></i>
      {{statusText}}
    </span>
  </div>

  <!-- Información de orden para secciones asociadas -->
  <div class="section-order-info" *ngIf="shouldShowOrder">
    <i class="pi pi-sort-numeric-down"></i> Orden: {{ sectionOrder }}
  </div>

  <!-- Información de tipología para secciones -->
  <div class="typology-info" *ngIf="typologyCode && !isInDualView">
    <i class="pi pi-sitemap"></i> {{ typologyCode }}
  </div>

  <!-- Indicador de estado en vista dual -->
  <div class="dual-view-indicator" *ngIf="isInDualView">
    <span class="indicator-badge" [ngClass]="{'available': isAvailable, 'associated': isAssociated}">
      <i class="pi" [ngClass]="isAvailable ? 'pi-list' : 'pi-check-circle'"></i>
      {{ isAvailable ? 'Disponible' : 'Asociada' }}
    </span>
  </div>

  <div class="card-content">
    <ng-content></ng-content>
  </div>

  <!-- Información adicional para diferentes tipos de preview -->
  <div class="preview-info" *ngIf="previewType === 'section' && (fieldCount || subsectionCount)">
    <div class="info-item" *ngIf="fieldCount">
      <i class="pi pi-th-large"></i>
      <span>{{ fieldCount }} campo{{ fieldCount > 1 ? 's' : '' }}</span>
    </div>
    <div class="info-item" *ngIf="subsectionCount">
      <i class="pi pi-window-maximize"></i>
      <span>{{ subsectionCount }} subsección{{ subsectionCount > 1 ? 'es' : '' }}</span>
    </div>
  </div>

  <div class="card-footer" *ngIf="showFooter">
    <div class="meta-data">
      <div class="meta-row" *ngIf="description">
        <i class="pi pi-align-left"></i> {{description}}
      </div>
      <div class="meta-row" *ngIf="date">
        <i class="pi pi-calendar"></i> {{date | date:'dd/MM/yyyy'}}
      </div>
    </div>
  </div>

  <!-- Indicador de drag para cards arrastrables -->
  <div class="drag-indicator" *ngIf="isDraggable">
    <i class="pi pi-arrows-alt"></i>
  </div>
</div>